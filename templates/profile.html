<!-- templates/profile.html -->

{% extends "base.html" %}


{% block content %}
    <div class="column is-6 is-offset-3">
        <h3 class="title">Profile</h3>

        <hr/>
        <br/>

        <div>Your API-Key(s):</div>
        <input type="checkbox" id="spoiler1"/>
        <label style="white-space: nowrap;" for="spoiler1">Show API-Key(s)</label>
        <div class="spoiler">
            {% for apikey in apikeys %}
                <div>
                    <nobr>{{ apikey.apikey }}</nobr>
                </div>
            {% endfor %}
        </div>

        <br/>
        <hr/>
        <br/>

        <input type="checkbox" id="spoiler2"/>
        <label style="white-space: nowrap;" for="spoiler2">Change E-Mail</label>
        <div class="spoiler">
            <div class="box">
                <form method="POST" action="{{ url_for('main_page.profile') }}">
                    <div class="field">
                        <div class="control">
                            <label class="form-group has-float-label">
                                <input class="input is-large button-fill is-rounded" type="email" name="current_email"
                                       disabled
                                       value="{{ current_email }}"
                                       autofocus=""><span>Current E-mail</span> </label>
                        </div>
                    </div>

                    <div class="field">
                        <div class="control">
                            <label class="form-group has-float-label">
                                <input class="input is-large button-fill is-rounded" type="email" name="new_email"
                                       placeholder="New E-Mail" required>
                                <span>New E-mail</span>
                            </label>
                        </div>
                    </div>
                    <button class="button is-large is-fullwidth">Change E-Mail</button>
                </form>
            </div>
        </div>
        <br/>
        <hr/>
        <br/>

        <input type="checkbox" id="spoiler3"/>
        <label style="white-space: nowrap;" for="spoiler3">Change Password</label>
        <div class="spoiler">
            <div class="box">
                <form method="POST" action="{{ url_for('main_page.profile') }}">
                    <div class="field">
                        <div class="control">
                            <label class="form-group has-float-label">
                                <input class="input is-large button-fill is-rounded" type="password" name="old_password"
                                       placeholder="Old Password"
                                       autofocus="" required><span>Old Password</span>
                            </label>
                        </div>
                    </div>

                    <div class="field">
                        <div class="control">
                            <label class="form-group has-float-label">
                                <input class="input is-large button-fill is-rounded" type="password" name="new_password"
                                       id="new_password"
                                       placeholder="New Password" required><span>New Password</span>
                            </label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="control">
                            <label class="form-group has-float-label">
                                <input class="input is-large button-fill is-rounded" type="password"
                                       name="new_password2" id="new_password2"
                                       placeholder="Repeat new Password" required><span>Repeat new Password</span>
                            </label>
                        </div>
                    </div>
                    <button class="button is-block is-large is-fullwidth" id="submit">Change Password</button>
                </form>
            </div>
        </div>
        <br/>
        <hr/>
        <br/>

        <span style="white-space: nowrap;"><span class="red"><a href="{{ url_for('delete.do_delete') }}">
            Delete
        </a></span> your account. THIS CAN NOT BE UNDONE.
        </span>
    </div>
{% endblock %}

{% block javascript %}
    {{ super() }}
    <script type="text/javascript">
        window.onload = function () {
            document.getElementById("new_password").onkeyup = validatePassword;
            document.getElementById("new_password2").onkeyup = validatePassword;
        }

        function validatePassword() {
            var pass2 = document.getElementById("new_password").value;
            var pass1 = document.getElementById("new_password2").value;
            if (pass1 !== pass2) {
                document.getElementById('new_password2').style.backgroundColor = "#ff6666";
                document.getElementById('new_password').style.backgroundColor = "#ff6666";
                document.getElementById("new_password2").setCustomValidity("Passwords Don't Match");
            } else {
                document.getElementById('new_password2').style.backgroundColor = "";
                document.getElementById('new_password').style.backgroundColor = "";
                document.getElementById("new_password2").setCustomValidity('');
            }
//empty string means no validation error
        }
    </script>
{% endblock %}